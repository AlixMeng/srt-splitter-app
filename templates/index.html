    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>字幕智能分割工具</title>
        <!-- 引入 Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            /* 使用 Inter 字体作为默认字体 */
            body {
                font-family: 'Inter', sans-serif;
                background-color: #f3f4f6; /* 轻灰色背景 */
            }
            /* 自定义滚动条样式 */
            ::-webkit-scrollbar {
                width: 8px;
            }
            ::-webkit-scrollbar-track {
                background: #e0e0e0;
                border-radius: 10px;
            }
            ::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 10px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
            /* 针对闪现消息的样式 */
            .flash-message {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 0.5rem;
                font-weight: 500;
                text-align: center;
            }
            .flash-message.error {
                background-color: #f8d7da; /* 红色系 */
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .flash-message.warning {
                background-color: #fff3cd; /* 黄色系 */
                color: #856404;
                border: 1px solid #ffeeba;
            }
            .flash-message.success {
                background-color: #d4edda; /* 绿色系 */
                color: #155724;
                border: 1px solid #c3e6cb;
            }
        </style>
    </head>
    <body class="flex flex-col items-center justify-center min-h-screen p-4">

        <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl transform transition duration-300 hover:scale-105">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">字幕智能分割工具</h1>

            <!-- Flash Messages Display -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-6">
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <form action="/" method="post" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <label for="files" class="block text-lg font-medium text-gray-700 mb-2">选择 SRT 文件 (可多选):</label>
                    <input type="file" id="files" name="files" multiple accept=".srt"
                           class="block w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="mt-1 text-sm text-gray-500" id="file_input_help">只支持 .srt 格式文件，最大16MB。</p>
                </div>

                <div>
                    <label for="max_chars_per_line" class="block text-lg font-medium text-gray-700 mb-2">
                        每行最大字符数 (显示宽度):
                    </label>
                    <input type="number" id="max_chars_per_line" name="max_chars_per_line"
                           min="10" max="100" value="{{ last_max_chars if last_max_chars is not none else 30 }}"
                           class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-base transition duration-150 ease-in-out">
                    <p class="mt-1 text-sm text-gray-500">
                        （一个汉字算2个字符宽度，英文、数字、半角符号算1个字符宽度。范围：10-100）
                    </p>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="remove_punctuation_checkbox" name="remove_punctuation_checkbox"
                           {% if last_remove_punc is not none and last_remove_punc %}checked{% elif last_remove_punc is none %}checked{% endif %}
                           class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded-md">
                    <label for="remove_punctuation_checkbox" class="ml-2 block text-lg font-medium text-gray-700 cursor-pointer select-none">
                        移除行末句号或逗号 (例如 "你好。" 变为 "你好")
                    </label>
                </div>

                <button type="submit"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                    开始处理
                </button>
            </form>

            <!-- Processed Files Section -->
            {% if processed_files %}
                <div class="mt-10 pt-6 border-t border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">处理结果</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for file in processed_files %}
                            <div class="bg-gray-50 p-4 rounded-lg shadow-md flex flex-col justify-between items-start space-y-3">
                                <p class="text-gray-700 font-semibold truncate w-full">
                                    原始文件: <span class="text-blue-600">{{ file.original_name }}</span>
                                </p>
                                <p class="text-gray-700 font-semibold truncate w-full">
                                    处理后: <span class="text-green-600">{{ file.processed_name }}</span>
                                </p>
                                <div class="flex flex-wrap gap-2 mt-2 w-full">
                                    <a href="{{ file.download_url }}"
                                       class="flex-1 min-w-0 md:min-w-fit px-4 py-2 bg-purple-500 text-white rounded-md text-center text-sm font-medium hover:bg-purple-600 transition duration-150 ease-in-out transform hover:scale-105 shadow-md">
                                        <svg class="inline-block w-4 h-4 mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                        下载
                                    </a>
                                    <a href="{{ file.preview_url }}" target="_blank"
                                       class="flex-1 min-w-0 md:min-w-fit px-4 py-2 bg-green-500 text-white rounded-md text-center text-sm font-medium hover:bg-green-600 transition duration-150 ease-in-out transform hover:scale-105 shadow-md">
                                        <svg class="inline-block w-4 h-4 mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                        预览
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- API Usage Section -->
        <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl mt-8 transform transition duration-300 hover:scale-105">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">API 使用说明</h2>
            <p class="text-gray-700 mb-4">您也可以通过发送 POST 请求到 <code>/api/process_subtitles</code> 接口来处理字幕文件。</p>
            <div class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm text-gray-800">
                <pre><code>
URL: /api/process_subtitles
方法: POST
内容类型: multipart/form-data

表单字段:
  - files: (文件, 必选) 一个或多个 .srt 文件
  - max_chars_per_line: (数字, 可选) 每行最大显示字符数 (默认: 30)
  - remove_punctuation_checkbox: (字符串, 可选) 如果要移除行末标点，设置为 'on' (默认: 'on')

示例 (使用 curl):
curl -X POST -F "files=@your_subtitle.srt" \
     -F "max_chars_per_line=40" \
     -F "remove_punctuation_checkbox=on" \
     http://your-server-ip:5000/api/process_subtitles \
     -o processed_subtitles.zip
                </code></pre>
            </div>
        </div>

        <footer class="mt-12 text-gray-600 text-sm">
            &copy; 2025 字幕智能分割工具. All rights reserved.
        </footer>
    </body>
    </html>
    
